# 정리
## 1. 엔티티 작성
### 1.1. 주의점
- (설계시)가급적 양방향 참조보단 단방향 참조로.
  - 이유는 모름
  - 예를 들면, '게시글을 등록할때 항상 첨부파일이 등록된다'가 아니라, '첨부파일이 등록될때 게시글이 필요하다' 라고 생각하는게 더 맞다.  
  사람 입장에서 생각하지말고 시스템 입장에서 생각해야함. 시스템 입장에서는 게시글과 첨부파일은 동등하다.

- lazy 에 관해
  - 모든 연관관계는 lazy 로
    - 무조건 lazy 로 하자. lazy 때문에 이슈가 발생한다고 생각한다면 잘못된 생각. 다 해결방법이 존재한다.

- cascade 에 관해
  - 모든 엔티티는 persist 하고 싶으면 기본적으로 다 각자 persist 해줘야함. persist()의 가장 기본은 엔티티마다 persist 하는 것
  - cascade 설정하면 같이 persist 되지만 원래 기본은 각각 다 persist 하는 것이다. cascade 는 persist 를 전파한다

- 비즈니스 로직
  - 데이터를 가지고 있는 쪽에 비즈니스 로직을 갖고있는게 가장 좋다 데이터와 연산은 깊은 관계가 있기때문에 같이 있는게 유지보수에 좋다

#### 기타 주의점
- 엔티티에는 항상 기본 생성자가 있어야함
  - 이유는 모름
  
## 2. 레포지토리 작성
- db 에 insert 하지 않아도 persist 만 해도 id 값이 generate 된다
- jpa 에서 엔티티를 저장할 때 연관된 모든 엔티티는 영속 상태여야 한다.
- 모든 연관관계는 일단 lazy 로 하고, 진짜 필요한 경우는 eager 로 바꾸자

## 3. 기타
- 캐시, 버퍼링
  - 캐시
    - 1차캐시, 2차캐시
  - 버퍼링
    - jdbc batch insert 기능을 jpa 가 알아서 해준다
      - 비슷한 쿼리들은 모아서 한방에 날린다
      - 트랜잭션 커밋은 맨 나중에.
      - jdbc batch 는 코드가 정말 지저분한데, jpa 는 간단한 설정만 해줘도 알아서 해줌